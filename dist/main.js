(()=>{"use strict";const e={events:{},data:{},subscribe:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},unsubscribe:function(e,t){if(this.events[e])for(let n=0;n<this.events[e].length;n++)if(this.events[e][n]===t){this.events[e].splice(n,1);break}},publish:function(e,t){this.events[e]&&this.events[e].forEach((function(e){e(t)}))}},t=function(){const t=function(t){t.replaceChildren();for(let n=0;n<10;n++){const o=document.createElement("div");for(let t=0;t<10;t++){const s=document.createElement("div");s.classList.add(`y${n}x${t}`),s.addEventListener("click",(t=>{t.composedPath()[2]===document.getElementById("new-board")?e.publish("placeShip",t):e.publish("cellSelection",t)})),o.append(s)}t.append(o)}return t},n=function(e,t){for(let n=0;n<10;n++)for(let o=0;o<10;o++)"object"==typeof e[n][o]?(t.children[n].children[o].classList.add(`ship${e[n][o].ship.body.length}`),"hit"===e[n][o].section.status?(t.children[n].children[o].classList.remove("ok"),t.children[n].children[o].classList.add("hit")):t.children[n].children[o].classList.add("ok"),!0===e[n][o].ship.isSunk()&&t.children[n].children[o].classList.add("sunk")):0===e[n][o]&&t.children[n].children[o].classList.add("miss")},o={boardOne:document.getElementById("board-one"),boardTwo:document.getElementById("board-two"),playerOneWrap:document.getElementById("player-one-wrap"),playerTwoWrap:document.getElementById("player-two-wrap"),endScreen:document.getElementById("end-screen"),endMessage:document.querySelector("#end-screen p"),endButton:document.querySelector("#end-screen button"),newScreen:document.getElementById("new-screen"),newBoard:document.getElementById("new-board"),newAxis:document.getElementById("axis-button"),newButton:document.getElementById("start-button"),ghIcon:document.getElementById("gh-icon")};return t(o.newBoard),{startDom:function(e){e.forEach((e=>t(e)))},renderShips:n,generateBoard:t,elements:o,switchTurn:function(){o.playerOneWrap.classList.toggle("turn"),o.playerTwoWrap.classList.toggle("turn")},hideNewScreen:function(){o.newScreen.classList.add("hidden")},showNewScreen:function(){o.newScreen.classList.remove("hidden")},hideEndScreen:function(){o.endScreen.classList.add("hidden")},showEndScreen:function(){o.endScreen.classList.remove("hidden")},updateDom:function(e){n(e.one.gameboard.board,o.boardOne),n(e.two.gameboard.board,o.boardTwo)},getCellIndex:function(e){return[+e.classList[0][1],+e.classList[0][3]]},switchAxis:function(){"X"===o.newAxis.textContent[o.newAxis.textContent.length-1]?(o.newAxis.textContent="Axis: Y",o.newBoard.classList.replace("x","y")):(o.newAxis.textContent="Axis: X",o.newBoard.classList.replace("y","x"))},newBoard:o.newBoard}}(),n=function(t){const n=function(){const t=function(){const e=[];for(let t=0;t<10;t++)e.push(Array(10));return e}(),n=[];return{board:t,ships:n,placeShip:function(e,o,s="x"){"x"!==s&&(s="y");let r=e[0],i=e[1];const a=o.body.length;if(r<0||r>9)throw new Error("Cannot place ship outside board bounds!");if(i<0||i>9)throw new Error("Cannot place ship outside board bounds!");if("y"===s){if(r>9-o.body.length+1)throw new Error("Ship is too big for this position!");let e=r;for(let n=0;n<a;n++){if("object"==typeof t[e][i])throw new Error("Space already has a ship!");e++}}else{if(i>9-o.body.length+1)throw new Error("Ship is too big for this position!");let e=i;for(let n=0;n<a;n++){if("object"==typeof t[r][e])throw new Error("Space already has a ship!");e++}}n.push(o);for(let e=0;e<a;e++)t[r][i]={ship:o,section:o.body[e]},"x"===s?i++:r++},receiveAttack:function(o){const s=t[o[0]][o[1]];if(void 0===s)t[o[0]][o[1]]=0;else if(s.section.status="hit",s.ship.isSunk())return n.every((e=>e.isSunk()))?e.publish("allShipsSunk",this):e.publish("shipSunk",s.ship)}}}(),o=function(t,n){if(t[0]<0||t[0]>9||t[1]<0||t[1]>9)throw new Error("Cannot attack outside the board!");return e.publish("attack",[n,t])};let s,r=[];const i=function(e){const t=[];return t.push([e[0],e[1]-1]),t.push([e[0],e[1]+1]),t.push([e[0]-1,e[1]]),t.push([e[0]+1,e[1]]),t};return{gameboard:n,type:t,attack:o,play:function(e,n){if("user"===t)throw new Error("Users cannot use play method!");let a;for(s&&e[s[0]][s[1]].ship.isSunk()&&(s=void 0,r=[]);;){if(r.length>0){if(a=r.pop(),a[0]>9||a[0]<0||a[1]>9||a[1]<0)continue}else a=[Math.floor(10*Math.random()),Math.floor(10*Math.random())];const t=e[a[0]][a[1]];if(void 0===t)break;if("object"==typeof t&&"ok"===t.section.status){s||(s=a),i(a).forEach((e=>r.push(e)));break}}return o(a,n)}}};!function(){const o=function(){return{one:n("user"),two:n("computer")}},s=function(){d=d===c.one?c.two:c.one,t.switchTurn()},r=function(e){const n=e.one,o=e.two;t.startDom([a.boardOne,a.boardTwo]);const s={player:n,board:a.boardOne},r={player:o,board:a.boardTwo};return t.showNewScreen(),{one:s,two:r}},i=function(e,n,o,s,r){const i=function(e){e<1&&(e=1),e>5&&(e=5);const t=function(e){const t=[];for(let n=0;n<e;n++)t.push({status:"ok"});return t}(e);return{length:e,body:t,hit:function(e){t[e].status="hit"},isSunk:function(){return t.every((e=>"hit"===e.status))}}}(s);e.gameboard.placeShip(o,i,r),t.renderShips(e.gameboard.board,n)},a=t.elements;let c=o(),d=c.one,l=r(c);e.subscribe("attack",(function(e){e[0]===c.two?c.two.gameboard.receiveAttack(e[1]):e[0]===c.one&&c.one.gameboard.receiveAttack(e[1]),t.updateDom(c)})),e.subscribe("cellSelection",(function(e){const n=e.target,o=t.getCellIndex(n);l.two.board===e.composedPath()[2]&&(d===c.two||("miss"===n.classList[1]||"hit"===n.classList[2]?console.log("Already attacked this position!"):(c.one.attack(o,c.two),s(),setTimeout((()=>{c.two.play(c.one.gameboard.board,c.one),s()}),1e3))))})),e.subscribe("allShipsSunk",(function(e){t.showEndScreen(),d===c.one?a.endMessage.textContent="You Win!":a.endMessage.textContent="You Lose!"})),e.subscribe("placeShip",(function(e){if(5===c.one.gameboard.ships.length)return;t.newBoard.classList.replace(`ship${c.one.gameboard.ships.length+1}`,`ship${c.one.gameboard.ships.length+2}`);const n=t.getCellIndex(e.composedPath()[0]),o=a.newAxis.textContent[a.newAxis.textContent.length-1].toLowerCase(),s=c.one.gameboard.ships.length+1;try{i(c.one,a.newBoard,n,s,o),5===c.one.gameboard.ships.length&&(a.newButton.disabled=!1)}catch{t.newBoard.classList.replace(`ship${c.one.gameboard.ships.length+2}`,`ship${c.one.gameboard.ships.length+1}`)}})),a.endButton.addEventListener("click",(function(){c=o(),l=r(c),d=c.one,t.hideEndScreen(),t.showNewScreen(),t.generateBoard(a.newBoard)})),a.newButton.addEventListener("click",(function(){c.one.gameboard.ships.length<5||(t.hideNewScreen(),function(){let e,t="x",n=5;for(;n>0;){e=[Math.floor(10*Math.random()),Math.floor(10*Math.random())];try{i(c.two,a.boardTwo,e,n,t),n--,t="x"===t?"y":"x"}catch{continue}}}(),t.renderShips(c.one.gameboard.board,a.boardOne))})),a.newAxis.addEventListener("click",t.switchAxis)}()})();